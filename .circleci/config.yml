version: 2
hosts:
  db: 127.0.0.1

jobs:
  build:
    docker:
      - image: python:latest
        environment:
          TOXENV: circleci
          PG_HOST: db
          PG_USER: postgres
      - image: postgres:latest
        environment:
          POSTGRES_USER: postgres
          POSTGRES_DB: postgres
          POSTGRES_PORT: 5432
    steps:
      - checkout
      - run: python -m venv venv
      - run: venv/bin/pip install tox
      - run: venv/bin/tox -e circleci
